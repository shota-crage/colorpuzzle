require=function e(t,i,o){function s(n,h){if(!i[n]){if(!t[n]){var r="function"==typeof require&&require;if(!h&&r)return r(n,!0);if(c)return c(n,!0);var a=new Error("Cannot find module '"+n+"'");throw a.code="MODULE_NOT_FOUND",a}var l=i[n]={exports:{}};t[n][0].call(l.exports,function(e){var i=t[n][1][e];return s(i||e)},l,l.exports,e,t,i,o)}return i[n].exports}for(var c="function"==typeof require&&require,n=0;n<o.length;n++)s(o[n]);return s}({BGColorSpread:[function(e,t,i){"use strict";cc._RF.push(t,"629658a9MJEvY5dNlft0zwY","BGColorSpread");var o=e("MessagePipeline"),s=["#44BCFF","#4462FF","#8F44FF","#E144FF","#FF448F","#FF4444","#FF7144","#FFAD44","#FFE144","#E9FF44","#C3FF44","#78FF44","#44FF8F","#44FFE9"],c=[["#4abdac","#fc4a1a","#f78733"],["#ffce00","#0375b4","#007849"],["#e37222","#07889b","#66b9bf"],["#004445","#2c7873","#6fb98f"],["#d7c3c7","#76323f","#c09f80"],["#e24e42","#e9b000","#008f95"],["#94618e","#49274a","#f4decb"],["#4484ce","#f9cf00","#f19f4d"],["#0b3c5d","#328cc1","#d9b310"],["#286da8","#cd5360","#438496"],["#ec576b","#4ec5c1","#e5e338"],["#77c9d4","#57bc90","#015249"],["#f7882f","#f7c331","#dcc7aa"],["#6e3667","#88d317","#cf6766"],["#fedc3d","#01abaa","#fea680"],["#b56357","#b4dbc0","#a7b3a5"],["#f81b84","#f5ce28","#43c0f6"],["#4cdef5","#a4d555","#ff5992"],["#841983","#99d3df","#88bbd6"],["#fa7c92","#6ec4db","#fff7c0"],["#6bbaa7","#fba100","#6c648b"],["#66ab8c","#b6a19e","#a9b7c0"],["#cccbc6","#efd9c1","#c7d8c6"],["#945d60","#626e60","#af473c"],["#67aeca","#e52a6f","#5f0f4e"],["#4d6e9c","#99ced4","#eeb6b7"],["#ccdfcb","#ff6a5c","#056571"],["#eab126","#f24c4e","#1b7b34"],["#155765","#57652a","#ab9353"],["#d48cf8","#0e8044","#b5e582"]];cc.Class({extends:cc.Component,properties:{BGColor1:cc.Node,BGColor2:cc.Node,BGColor3:cc.Node,BGColorSpread1:cc.Node,BGColorSpread2:cc.Node,BGColorSpread3:cc.Node,anim:cc.Animation},onLoad:function(){this.colorIndex=0,o.messagePipeline.on("onLevelUp",this._onLevelUp,this),o.messagePipeline.on("onGameOver",this._onGameOver,this),o.messagePipeline.on("onReset",this._onReset,this),o.messagePipeline.on("onBeat",this._onBeat,this),o.messagePipeline.on("onBar",this._onBar,this),this.onBeatAnim=cc.sequence(cc.scaleTo(0,.6),cc.scaleTo(1,.5)),this.onBarAnim=cc.sequence(cc.scaleTo(0,.6),cc.scaleTo(4,.5))},_onReset:function(){this.BGColor1.color=cc.hexToColor(c[this.colorIndex][0]),this.BGColor2.color=cc.hexToColor(c[this.colorIndex][1]),this.BGColor3.color=cc.hexToColor(c[this.colorIndex][2]),this.anim.play("BGColorGameStart")},_onLevelUp:function(e){this.colorIndex=(this.colorIndex+1)%s.length,this.BGColorSpread1.color=cc.hexToColor(c[this.colorIndex][0]),this.BGColorSpread2.color=cc.hexToColor(c[this.colorIndex][1]),this.BGColorSpread3.color=cc.hexToColor(c[this.colorIndex][2]),this.anim.play("BGColorSpread")},_onBGColorSpread:function(){this.BGColorSpread1.setScale(0),this.BGColor1.color=cc.hexToColor(c[this.colorIndex][0]),this.BGColor2.color=cc.hexToColor(c[this.colorIndex][1]),this.BGColor3.color=cc.hexToColor(c[this.colorIndex][2])},_onGameOver:function(e){this.anim.play("BGGameOver")},_onBeat:function(){this.BGColor3.runAction(this.onBeatAnim)},_onBar:function(){this.BGColor2.runAction(this.onBarAnim)}}),cc._RF.pop()},{MessagePipeline:"MessagePipeline"}],BGMPlay:[function(e,t,i){"use strict";cc._RF.push(t,"2d5b2JU2+xKj48M1Tqd5Mq4","BGMPlay");var o=e("MessagePipeline");cc.Class({extends:cc.Component,properties:{BPM:126,beat:4,minBeat:4},onLoad:function(){this.tmpTimer=0,this.tmpTotalTimer=0,this.musicStartTime=0,this._audioScore=this.getComponent(cc.AudioSource),this.minBeatCount=0,this.nextMinBeatTime=0,this.minBeatTime=60/this.BPM/this.minBeat,this.isOnMinBeat=!1,this.inOnBeat=!1,this.isOnBar=!1,o.messagePipeline.on("onReset",this.playBGM,this),o.messagePipeline.on("onGameOver",this.stopBGM,this)},playBGM:function(){this._audioScore&&(this._audioScore.play(),this.tmpTimer=0,this.tmpTotalTimer=0,this.minBeatCount=0,this.nextMinBeatTime=0,this.isOnMinBeat=!1,this.inOnBeat=!1,this.isOnBar=!1)},stopBGM:function(){this._audioScore&&this._audioScore.stop()},update:function(e){if(this._audioScore&&this._audioScore.isPlaying){var t=this._audioScore.getCurrentTime();this.tmpTotalTimer+=e,this.tmpTotalTimer<this.musicStartTime||(this.tmpTimer+=e,t-this.tmpTotalTimer>=.05?(this.tmpTimer+=.05,this.tmpTotalTimer+=.05):t-this.tmpTotalTimer<=-.05&&(this.tmpTimer-=.05,this.tmpTotalTimer-=.05),0===this.minBeatCount||this.tmpTimer>=this.minBeatTime&&!this.isOnMinBeat?(0!==this.minBeatCount&&(this.tmpTimer-=this.minBeatTime),this.isOnMinBeat=!0,this.minBeatCount%this.minBeat==0&&(this.inOnBeat=!0),this.minBeatCount%(this.minBeat*this.beat)==0&&(this.isOnBar=!0),this.minBeatCount+=1):(this.isOnMinBeat=!1,this.inOnBeat=!1,this.isOnBar=!1),this.isOnMinBeat&&o.messagePipeline.sendMessage("onMinBeat",this.minBeatCount),this.inOnBeat&&o.messagePipeline.sendMessage("onBeat",this),this.isOnBar&&o.messagePipeline.sendMessage("onBar",this))}}}),cc._RF.pop()},{MessagePipeline:"MessagePipeline"}],Enemy:[function(e,t,i){"use strict";cc._RF.push(t,"7f7cef6WkZP/4v1YtBKlq0P","Enemy"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){}}),cc._RF.pop()},{}],FieldTouch:[function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}cc._RF.push(t,"a0d97stdatL6aHGOgxXtmk/","FieldTouch");var s=o(e("./Pieces")),c=(o(e("../core/SEPlay")),o(e("../core/GameFlow")));cc.Class({extends:cc.Component,properties:{pieces:s.default,marker:cc.Node,moveTime:6,timerSprite:cc.Sprite},onLoad:function(){this._registerEvent(),this._leftBottomPos=cc.p(-this.node.width/2,-this.node.height/2),this._rightTopPos=cc.p(this.node.width/2,this.node.height/2),this._touchId="",this._timer=this.moveTime,this._isTouch=!1},onDestroy:function(){this._unregisterEvent()},_onTouchBegan:function(e){if(c.default.instance.isTouchTurn){var t=e.getLocation();t=this.node.convertToNodeSpaceAR(t),this._touchId=this._getTouchId(t);var i=this.pieces.getTouchStartPiece(this._touchId);this.marker.width=this.pieces.pieceW,this.marker.height=this.pieces.pieceH,this.marker.position=t,this.marker.getComponent(cc.Sprite).spriteFrame=i.pieceSprite.spriteFrame,this.marker.color=i.pieceSprite.node.color,this._isTouch=!0,this._timer=this.moveTime}},_onTouchMove:function(e){if(c.default.instance.isTouchTurn&&this._isTouch){var t=e.getLocation();(t=this.node.convertToNodeSpaceAR(t)).x=Math.max(this._leftBottomPos.x,Math.min(this._rightTopPos.x,t.x)),t.y=Math.max(this._leftBottomPos.y,Math.min(this._rightTopPos.y,t.y)),this.marker.position=t;var i=this._getTouchId(t);this._touchId!==i&&(this.pieces.swap(this._touchId,i),this._touchId=i)}},_getTouchId:function(e){var t=e.sub(this._leftBottomPos);return Math.min(this.pieces.xPiece-1,Math.floor(t.x/this.pieces.pieceW))+"-"+Math.min(this.pieces.yPiece-1,Math.floor(t.y/this.pieces.pieceH))},_finishTouch:function(e){c.default.instance.isTouchTurn&&(this.pieces.touchEndPiece(this._touchId),this.marker.x=-1e3,this._isTouch=!1,c.default.instance.nextPhase())},update:function(e){this._isTouch&&(this._timer-=e,this.timerSprite.fillRange=this._timer/this.moveTime,this._timer<=0&&this._finishTouch({}))},_onTouchEnded:function(e){this._finishTouch(e)},_onTouchCancel:function(e){this._finishTouch(e)},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this)},_unregisterEvent:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this)}}),cc._RF.pop()},{"../core/GameFlow":"GameFlow","../core/SEPlay":"SEPlay","./Pieces":"Pieces"}],GameFlow:[function(e,t,i){"use strict";cc._RF.push(t,"f6ca3+ROBZE24u1h6XUgFOv","GameFlow"),Object.defineProperty(i,"__esModule",{value:!0});var o=["touch","delete"],s=cc.Class({extends:cc.Component,properties:{phase:{visible:!1,get:function(){return this._phase}},isTouchTurn:{get:function(){return this._flowIndex===this._flowTOUCH}},isDeleteTurn:{get:function(){return this._flowIndex===this._flowDELETE}}},statics:{instance:null},onLoad:function(){s.instance=this,this._flowIndex=0,this._flowCount=o.length,this._flowTOUCH=o.indexOf("touch"),this._flowDELETE=o.indexOf("delete"),this._flowENEMY=o.indexOf("enemy")},nextPhase:function(){this._flowIndex=(this._flowIndex+1)%this._flowCount}});i.default=s,t.exports=i.default,cc._RF.pop()},{}],MessagePipeline:[function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}cc._RF.push(t,"cf771H+nwxPKaA6R6epNabN","MessagePipeline"),Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),h=function(e){function t(){return o(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,cc.EventTarget),n(t,[{key:"sendMessage",value:function(e,t){cc.log("dispatch system notification "+e),this.emit(e,t)}}]),t}();i.messagePipeline=new h;cc._RF.pop()},{}],Mochi:[function(e,t,i){"use strict";cc._RF.push(t,"c8b96VRd6FDm5LsyllTzY43","Mochi");var o=e("MessagePipeline");cc.Class({extends:cc.Component,properties:{nextLevel:10},onLoad:function(){this.currentSize=1,this.currentLevel=1,this.black=0,o.messagePipeline.on("onReset",this._onReset,this)},update:function(e){},_onReset:function(){this.currentSize=1,this.currentLevel=1,this.black=0;var e=this.scaling(),t=this.coloring();this.node.runAction(cc.spawn(e,t))},eat:function(e){if(this.currentSize+=e/100,this.currentSize>=this.nextLevel){this.currentSize=1,this.currentLevel+=1,this.black=Math.floor(this.black/2),o.messagePipeline.sendMessage("onBlacken",this.black);var t=this.scaling(),i=this.coloring();this.node.runAction(cc.spawn(t,i)),o.messagePipeline.sendMessage("onLevelUp",this.currentLevel),o.messagePipeline.sendMessage("SOUND_PLAY","levelup")}else{var s=cc.scaleTo(.1,this.currentSize);this.node.runAction(s)}o.messagePipeline.sendMessage("SOUND_PLAY","eat")},blacken:function(){if(this.black<100){this.black=Math.min(100,this.black+this.currentLevel),o.messagePipeline.sendMessage("onBlacken",this.black),this.black>=100&&o.messagePipeline.sendMessage("onGameOver",this.currentLevel);var e=this.coloring();this.node.runAction(e)}},scaling:function(){return cc.scaleTo(.1,this.currentSize)},coloring:function(){var e=2.25*this.black;return cc.tintTo(.1,255-e,255-e,255-e)}}),cc._RF.pop()},{MessagePipeline:"MessagePipeline"}],NewScript:[function(e,t,i){"use strict";cc._RF.push(t,"783ceRISx1KGYRFNs2bEI6S","NewScript"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){}}),cc._RF.pop()},{}],PhysicsEnabler:[function(e,t,i){"use strict";cc._RF.push(t,"0d7cb/KZYRMqLIrJQbkcpKx","PhysicsEnabler"),cc.Class({extends:cc.Component,properties:{enabledDebugDraw:!0,enabledDrawBoundingBox:!0},onLoad:function(){cc.director.getPhysicsManager().enabled=!0;var e=cc.director.getCollisionManager();e.enabled=this.enabled,e.enabledDebugDraw=this.enabledDebugDraw,e.enabledDrawBoundingBox=this.enabledDrawBoundingBox}}),cc._RF.pop()},{}],PieceDelete:[function(e,t,i){"use strict";cc._RF.push(t,"8b877KhiUBPfKwOyKK069Bg","PieceDelete"),cc.Class({extends:cc.Component,properties:{anim:cc.Animation,nodes:{default:[],type:[cc.Node]}},onLoad:function(){this.anim.on("finished",this._finished,this)},reuse:function(e){this.nodes.forEach(function(t){t.color=e.color}),this.node.rotation=360*Math.random(),this.anim.play()},unuse:function(){},_finished:function(){this._backToPool()},setPool:function(e){this._pool=e},_backToPool:function(){this._pool&&this._pool.put(this.node)}}),cc._RF.pop()},{}],PiecesDelete:[function(e,t,i){"use strict";cc._RF.push(t,"43ea9zCDXZIOpKUSStzIaF8","PiecesDelete"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){}}),cc._RF.pop()},{}],Pieces:[function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}cc._RF.push(t,"9c9ccDE1H9AWawcxciSryQo","Pieces"),Object.defineProperty(i,"__esModule",{value:!0});var s=o(e("../core/PrefabNodePool")),c=o(e("../core/GameFlow")),n=cc.Class({extends:cc.Component,properties:{piecePrefab:cc.Prefab,pieceDeletePrefab:cc.Prefab,pieceDeleteNode:cc.Node,xPiece:{default:7,range:[1,9,1]},yPiece:{default:7,range:[1,9,1]},colors:{default:[],type:cc.Color},pieceW:{visible:!1,get:function(){return this._pieceW}},pieceH:{visible:!1,get:function(){return this._pieceH}},deleteInterval:.5},statics:{instance:null},onLoad:function(){n.instance=this,this.piecePool=new s.default(this.piecePrefab,this.xPiece*this.yPiece,10,"Piece"),this.pieceDeletePool=new s.default(this.pieceDeletePrefab,20,10,"PieceDelete"),this._pieceW=this.node.width/this.xPiece,this._pieceH=this.node.height/this.yPiece,this._basePos=cc.p(-(this.xPiece-1)*this._pieceW/2,-(this.yPiece-1)*this._pieceH/2),this._colorCount=this.colors.length,this._spawnColorTable=[],this._createSpawnColorTable(),this._checkedList=[],this._deleteTimer=0,this._nextPieceYAdj=[],this._deletedIDList=[],this._deletingSpecialPieceIDList=[];for(var e=0;e<this.yPiece;e++)this._nextPieceYAdj.push(0);this._deletingSpecialPieceIDList=[],this._pieces={},this._fieldInit()},_createSpawnColorTable:function(){for(var e=0;e<this._colorCount;e++){for(var t=[],i=0;i<this._colorCount;i++)e!==i&&t.push(i);this._spawnColorTable.push(t)}},_fieldInit:function(){for(var e=0;e<this.yPiece;e++)for(var t=0;t<this.xPiece;t++){var i=this._getType(t,e),o=this._spawn(t,e,i,!0);this._pieces[t+"-"+e]=o}},_getType:function(e,t){var i=-1,o=-1;e>=2&&this._pieces[e-1+"-"+t].colorType===this._pieces[e-2+"-"+t].colorType&&(i=this._pieces[e-1+"-"+t].colorType),t>=2&&this._pieces[e+"-"+(t-1)].colorType===this._pieces[e+"-"+(t-2)].colorType&&(o=this._pieces[e+"-"+(t-1)].colorType);for(var s=[],c=0;c<this._colorCount;c++)c!==i&&c!==o&&s.push(c);return s[Math.floor(Math.random()*s.length)]},_spawn:function(e,t,i,o){var s=this.piecePool.get({x:e,y:t,w:this._pieceW,h:this._pieceH,init:o,basePos:this._basePos,type:i,color:this.colors[i]});return s.parent=this.node,s.on("onFallEnd",this.fallEndCount,this),s.getComponent("Piece")},getTouchStartPiece:function(e){return this._pieces[e].node.opacity=127,this._pieces[e]},touchEndPiece:function(e){this._deleteCheckStart=!0,this._deleteTimer=this.deleteInterval,this._pieces[e].node.opacity=255},swap:function(e,t){var i=this._pieces[e],o=this._pieces[t];i.moveTo(t),o.moveTo(e),this._pieces[e]=o,this._pieces[t]=i,this.searchMatch()},searchMatch:function(){this._checkedList=[];for(var e=[],t="",i=-1,o=-1,s=[],c=0;c<this.yPiece;c++){o=-1,i=-1,s=[];for(var n=0;n<this.xPiece;n++){if(t=n+"-"+c,i=this._pieces[t].colorType,this._pieces[t].deleteMarkOff(),o!==i){if(s.length>=3){this._checkedList.push([s]),e=e.concat(s);for(var h=0;h<s.length;h++)this._pieces[s[h]].deleteMarkOn()}o=i,s=[]}if(s.push(t),n===this.xPiece-1&&s.length>=3){this._checkedList.push([s]),e=e.concat(s);for(var r=0;r<s.length;r++)this._pieces[s[r]].deleteMarkOn()}}}for(var a=0;a<this.xPiece;a++){o=-1,i=-1,s=[];for(var l=0;l<this.yPiece;l++){if(t=a+"-"+l,i=this._pieces[t].colorType,o!==i){if(s.length>=3){this._checkedList.push([s]),e=e.concat(s);for(var p=0;p<s.length;p++)this._pieces[s[p]].deleteMarkOn()}o=i,s=[]}if(s.push(t),l===this.yPiece-1&&s.length>=3){this._checkedList.push([s]),e=e.concat(s);for(var u=0;u<s.length;u++)this._pieces[s[u]].deleteMarkOn()}}}e.sort();for(var f=[],d=0;d<e.length;d++)if(d>0&&e[d-1]===e[d]){f=[];for(var _=0;_<this._checkedList.length;_++)for(var T=0;T<this._checkedList[_].length;T++)if(this._checkedList[_][T].indexOf(e[d])>=0){f=f.concat(this._checkedList[_]),this._checkedList.splice(_,1),_-=1;break}this._checkedList.push(f)}for(var P=0;P<this._checkedList.length;P++)for(var m=0;m<this._checkedList[P].length;m++);},_spawnPieceDelete:function(e,t,i){var o=this.pieceDeletePool.get({color:this.colors[i]});o.parent=this.node,o.position=cc.p(this._basePos.x+this._pieceW*e,this._basePos.y+this._pieceH*t)},update:function(e){if(c.default.instance.isDeleteTurn&&this._deleteCheckStart){if(this._deleteTimer+=e,this._deleteTimer<this.deleteInterval)return;if(this._deleteTimer=0,this._checkedList.length<=0)return void this.fall();for(var t=this._checkedList[0],i=[],o="",s=0,n=0;n<t.length;n++)s<t[n].length&&(s=t[n].length);var h=0;if(s>=5)h=4;else if(t.length>1)h=3;else if(4===s){var r=this.getXYfromID(t[0][0]),a=this.getXYfromID(t[0][1]);h=r[0]===a[0]?1:2}for(var l="",p=0;p<t.length;p++){i=t[p];for(var u=0;u<i.length;u++)o=i[u],0!==p||0!==u||0===h?o!==l&&(0===this._pieces[o].pieceType?this.deleteOnePiece(o):this._deletingSpecialPieceIDList.push(o)):(this._pieces[o].changePieceType(h,4===h),l=o)}this._checkedList.splice(0,1)}},fall:function(){if(this._deleteCheckStart=!1,0!==this._deletedIDList.length){this._deletedIDList.sort();var e={};this._fallCount=0;for(var t=0;t<this.xPiece;t++){for(var i=0,o=!1,s=[],c=0;c<this.yPiece;c++){var n=t+"-"+c,h=this._deletedIDList.indexOf(n);if(h>=0)this._deletedIDList.splice(h,1),s.push(n),o=!0;else{var r=t+"-"+i;if(e[r]=this._pieces[n],o){e[r].fall(r),this._fallCount+=1;var a=this._deletingSpecialPieceIDList.indexOf(n);a>=0&&(this._deletingSpecialPieceIDList[a]=r)}i+=1}}for(var l=0;l<s.length;l++){var p=t+"-"+(i+l);this._pieces[s[l]].setDeletedPosition(t,this.yPiece+l,this._basePos.y),e[p]=this._pieces[s[l]],e[p].fall(p),this._fallCount+=1}}this._pieces=e}else this.fallEnd(!1)},fallEndCount:function(){this._fallCount>0&&(this._fallCount-=1,this._fallCount<=0&&this.fallEnd(!0))},fallEnd:function(e){for(var t=this,i=0;i<this._nextPieceYAdj.length;i++)this._nextPieceYAdj[i]=0;this._deletingSpecialPieceIDList.length>0?(this._specialPieceDeleteStart=!0,setTimeout(function(){t.specialPieceEffect()},1e3*this.deleteInterval)):e?(this.searchMatch(),this._deleteTimer=this.deleteInterval,this._deleteCheckStart=!0):c.default.instance.nextPhase()},specialPieceEffect:function(){this.nextSpecialPieces=[];for(var e=0;e<this._deletingSpecialPieceIDList.length;e++){var t=this._deletingSpecialPieceIDList[e],i=this.getXYfromID(t);if(1===this._pieces[t].pieceType)for(var o=0;o<this.xPiece;o++)this.deleteOnePieceBySpecialPiece(t,o,i[1]);else if(2===this._pieces[t].pieceType)for(var s=0;s<this.yPiece;s++)this.deleteOnePieceBySpecialPiece(t,i[0],s);else if(3===this._pieces[t].pieceType)for(var c=Math.max(0,i[0]-1),n=Math.min(this.xPiece-1,i[0]+1),h=Math.max(0,i[1]-1),r=Math.min(this.yPiece-1,i[1]+1),a=c;a<=n;a++)for(var l=h;l<=r;l++)this.deleteOnePieceBySpecialPiece(t,a,l);else{if(4!==this._pieces[t].pieceType)continue;for(var p=this._pieces[t].colorType,u=0;u<this.xPiece;u++)for(var f=0;f<this.yPiece;f++)this._pieces[u+"-"+f].colorType===p&&this.deleteOnePieceBySpecialPiece(t,u,f)}this.deleteOnePiece(t)}this._deletingSpecialPieceIDList=this.nextSpecialPieces,this.fall()},deleteOnePieceBySpecialPiece:function(e,t,i){var o=t+"-"+i;e!==o&&(0===this._pieces[o].pieceType?this.deleteOnePiece(o):this.nextSpecialPieces.push(o))},deleteOnePiece:function(e){if(!(this._deletedIDList.indexOf(e)>=0)){this._deletedIDList.push(e);var t=this.getXYfromID(e);this._spawnPieceDelete(t[0],t[1],this._pieces[e].colorType);var i=Math.floor(Math.random()*this.colors.length);this._pieces[e].deleteUp(this._basePos.y,this.yPiece+this._nextPieceYAdj[t[0]],i,this.colors[i]),this._nextPieceYAdj[t[0]]+=1}},getXYfromID:function(e){var t=e.split("-");return t[0]=Number(t[0]),t[1]=Number(t[1]),t}});i.default=n,t.exports=i.default,cc._RF.pop()},{"../core/GameFlow":"GameFlow","../core/PrefabNodePool":"PrefabNodePool"}],Piece:[function(e,t,i){"use strict";cc._RF.push(t,"a8bfdKZBLNGR5oNYGMR/+ZR","Piece");cc.Class({extends:cc.Component,properties:{testLabel:cc.Label,id:{visible:!1,get:function(){return this._id},set:function(e){this._id=e}},colorType:{visible:!1,get:function(){return this._colorType}},pieceSprites:{default:[],type:[cc.SpriteFrame]},pieceType:{visible:!1,get:function(){return this._pieceType}},pieceSprite:cc.Sprite,deleteMark:cc.Node,anim:cc.Animation},onLoad:function(){},reuse:function(e){e.init&&(this.pieceSprite.node.width=e.w,this.pieceSprite.node.height=e.h),this._id=e.x+"-"+e.y,this.testLabel.string=this._id,this.node.x=e.basePos.x+e.w*e.x,this.node.y=e.basePos.y+e.h*e.y,this._colorType=e.type,this.pieceSprite.node.color=e.color,this._pieceType=0,this.pieceSprite.spriteFrame=this.pieceSprites[this._pieceType],this._moveCues=[]},unuse:function(){},deleteMarkOn:function(){this.deleteMark.active=!0},deleteMarkOff:function(){this.deleteMark.active=!1},moveTo:function(e,t){this._getMoveAction(e,t),this._id=e,this.testLabel.string=this._id},_getMoveAction:function(e,t){var i=this,o=this._id.split("-"),s=e.split("-"),c=new cc.p(Number(o[0]),Number(o[1])),n=new cc.p(Number(s[0]),Number(s[1]));n.subSelf(c);var h=.1;t&&(h=Math.abs(.1*n.y));var r=cc.moveBy(h,n.x*this.pieceSprite.node.width,n.y*this.pieceSprite.node.height);t&&(r=cc.sequence(r,cc.callFunc(function(){i.node.emit("onFallEnd")},this))),this.node.runAction(r)},deleteUp:function(e,t,i,o){this._colorType=i,this.pieceSprite.node.color=o,this.node.y=e+this.pieceSprite.node.height*t,0!==this._pieceType&&this.changePieceType(0,!1),this.deleteMarkOff()},setDeletedPosition:function(e,t,i){this._id=e+"-"+t,this.node.y=i+this.pieceSprite.node.height*t},fall:function(e){this.moveTo(e,!0)},changePieceType:function(e,t){this._pieceType=e,this.pieceSprite.spriteFrame=this.pieceSprites[this._pieceType],0!==this._pieceType&&this.anim.play("PieceSpecialAppear"),this.deleteMarkOff()},setPool:function(e){this._pool=e},_backToPool:function(){this._pool&&this._pool.put(this.node)}}),cc._RF.pop()},{}],PrefabNodePool:[function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}cc._RF.push(t,"47ce8L0i5xPjpkhWhpT41Mv","PrefabNodePool"),Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),h=function e(t,i,o){null===t&&(t=Function.prototype);var s=Object.getOwnPropertyDescriptor(t,i);if(void 0===s){var c=Object.getPrototypeOf(t);return null===c?void 0:e(c,i,o)}if("value"in s)return s.value;var n=s.get;if(void 0!==n)return n.call(o)},r=function(e){function t(e,i,c,n){o(this,t);var h=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n));return h._handler=n,h._prefab=e,h._capacity=i,h._increase=c,h._peak=0,h._toBePutBackToPool=[],h}return c(t,cc.NodePool),n(t,[{key:"init",value:function(){for(var e=0;e<this._capacity;e++){var i=this._createNode();h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"put",this).call(this,i)}}},{key:"_createNode",value:function(){var e=cc.instantiate(this._prefab);if(this._handler){var t=e.getComponent(this._handler);t&&t.setPool(this)}return e}},{key:"get",value:function(e){if(0===this.size()){for(var i=0;i<this._increase;i++){var o=this._createNode();h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"put",this).call(this,o)}this._capacity+=this._increase}var s=h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"get",this).call(this,e);return this._peak=Math.max(this.countInUse,this._peak),s}},{key:"put",value:function(e){h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"put",this).call(this,e)}},{key:"update",value:function(){}},{key:"countInUse",get:function(){return this._capacity-this.size()}},{key:"countPeak",get:function(){return this._peak}}]),t}();i.default=r,t.exports=i.default,cc._RF.pop()},{}],SEPlay:[function(e,t,i){"use strict";cc._RF.push(t,"132b92D0ChFHpuNjkDle2qU","SEPlay"),Object.defineProperty(i,"__esModule",{value:!0});var o=cc.Class({extends:cc.Component,properties:{},statics:{instance:null},onLoad:function(){o.instance=this,this.audioSources=this.node.getComponents(cc.AudioSource),this.SElist={};for(var e=0;e<this.audioSources.length;e++){var t=this.audioSources[e].clip;this.SElist[t.substring(t.lastIndexOf("/")+1,t.lastIndexOf("."))]=this.audioSources[e]}},play:function(e){this.SElist[e].isPlaying,this.SElist[e].play()}});i.default=o,t.exports=i.default,cc._RF.pop()},{}],TouchInput:[function(e,t,i){"use strict";cc._RF.push(t,"ebbbaGZgelHMo+XOSruDJ7R","TouchInput"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this._registerEvent()},onDestroy:function(){this._unregisterEvent()},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this)},_unregisterEvent:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this)},_onTouchBegan:function(e){e.getLocation()},_onTouchMove:function(e){e.getLocation()},_onTouchEnded:function(e){this._finishTouch(e)},_onTouchCancel:function(e){this._finishTouch(e)},_finishTouch:function(e){e.getLocation()}}),cc._RF.pop()},{}]},{},["NewScript","BGColorSpread","Mochi","BGMPlay","GameFlow","MessagePipeline","PhysicsEnabler","PrefabNodePool","SEPlay","TouchInput","Enemy","FieldTouch","Piece","PieceDelete","Pieces","PiecesDelete"]);